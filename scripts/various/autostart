#!/usr/bin/env bash

############################ Network ############################
: "${def:=enp8s0}"
: "${alt:=enp21s0f4u2}"

readarray -t connections < <(
    nmcli -t -f NAME,DEVICE connection show --active | \
    awk -F: -v d="$def" -v a="$alt" '
        $0 !~ /lo/ && ($2 ~ d || $2 ~ a) { print $1 }
    '
)

(( ${#connections[@]} > 1 )) && \
    urxvtc -name floaterm -geometry 50x2 \
    -e network_switch_connection -c 60

############################# Sound #############################
# muting HDMI source/sink & webcam mic too.
for type in source sink; do
    for index in 0 1; do
        if [[ "$type" != "sink" || "$index" != "1" ]]; then
            pactl set-${type}-volume $index 0%
            pactl set-${type}-mute $index true
        fi
    done
done
unset index type
pactl set-sink-volume 1 50%

pgrep -x polybar &>/dev/null && {
    pid=$(pgrep -f "$(wmctrl -m | awk '/Name/{print $2}')"-bar-2)
    polybar-msg -p "$pid" action "#mic-ipc.hook.0" >/dev/null 2>&1
    polybar-msg -p "$pid" action "#volume-ipc.hook.1" >/dev/null 2>&1
}

####################### Wallpaper setter #######################
if command -v nitrogen >/dev/null; then
    nitrogen --restore &
else
    sh -c "$XDG_CONFIG_HOME"/.fehbg &
fi

#################### keyboard colors profile ####################
command -v g810-led >/dev/null && {
    profile_rules="/etc/udev/rules.d/g810-led.rules"
    profile_udev=$(grep -e 'profile_' "$profile_rules" | sed 's,.*/,,;s/"//;s/profile_//')
    g810_switch_profile "$profile_udev"
}

##################### Updates checker script #####################
[[ ! -f $XDG_RUNTIME_DIR/combined.list ]] && updates-manager --chck

####################### Backups & cleaning #######################
command -v rsync >/dev/null && {
    rsync -apq "$SCRIPTDIR"/* "$HOME"/Documents/scripts/ &
    rsync -apq "$XDG_CONFIG_HOME"/* "$HOME"/Documents/configs/ &
}

# urxvtc &

