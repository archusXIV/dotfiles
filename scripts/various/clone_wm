#!/bin/bash

# Author: Barret E <archus@protonmail.com>
# github directory: https://github.com/archusXIV/wm_config
# Youtube channel: <https://www.youtube.com/@linuxinfrench9388>
#
# BE CAREFULL, this scripts will erase all the content of critical directories
# in your $HOME folder such as ~/.config & ~/.local and replace them with
# a simple customization to get ready to go and use an i3/bspwm desktops.
# It also provide other critical files such as shell configs (.bashrc,.zshrc)
# .Xresources, .Xmodmap, .xinitrc and systemd user services.
# So it is intended to be used on a very first desktop installation.
# USE IT AT YOUR OWN RISKS.

# Colors
nc=$'\e[0;m';
g=$'\e[1;32m';
r=$'\e[0;31m';
y=$'\e[93m';

[[ -d ~/.config ]] && rm -rf  ~/.config
[[ -d ~/.local ]] && rm -rf  ~/.local

git clone https://github.com/archusXIV/wm_config.git
cd wm_config/ || exit 1

KBD=$(sed 's/KEYMAP=//;s/-.*//' /etc/vconsole.conf | sed -n '1p')

_i3Config() {
    
    if [[ -n $(command -v i3) ]]; then
        
        printf '%s\n' " ${y}Configuring I3PWM.${nc}"
        sleep 1s
        mv config .config \
        && mv local .local \
        && chmod +x .local/bin/* \
        && echo "setxkbmap $KBD" >> .local/bin/autostart \
        && {
            if [[ $KBD = fr ]]; then
                echo 'export LANG="fr_FR.UTF-8"' >> .bash_profile
            elif [[ $KBD = en ]]; then
                echo 'export LANG="en_US.UTF-8"' >> .bash_profile
            fi
        } && mv -f .local .. && mv -f .config .. \
        && mv -f wallpapers ~/Documents/ \
        && chmod +x .fehbg && chmod +x ~/.config/ranger/scope.sh \
        && mv -f .{bash_profile,bashrc,zshenv,zshrc,fehbg,xinitrc,Xresources} .. \
        && echo "exec i3" >> ~/.xinitrc \
        && cd ~ && rm -rf wm_config \
        && printf '%s\n' " ${y}i3wm configured, rebooting...${nc}" \
        && sleep 2s && reboot
    else
        printf '%s\n' " ${r}i3wm is not installed.${nc}"
        sleep 3s
    fi
    
}

_bspwmConfig() {
    
    if [[ -n $(command -v bspwm) ]]; then
        
        printf '%s\n' " ${y}Configuring BSPWM.${nc}"
        sleep 1s
        mv config .config \
        && chmod +x .config/bspwm/bspwmrc \
        && mv local .local \
        && chmod +x .local/bin/* \
        && echo "setxkbmap $KBD" >> .local/bin/autostart \
        && {
            if [[ $KBD = fr ]]; then
                echo 'export LANG="fr_FR.UTF-8"' >> .bash_profile
            elif [[ $KBD = en ]]; then
                echo 'export LANG="en_US.UTF-8"' >> .bash_profile
            fi
        } && mv -f .local .. && mv -f .config .. \
        && mv -f wallpapers ~/Documents/ \
        && chmod +x .fehbg && chmod +x ~/.config/ranger/scope.sh \
        && mv -f .{bash_profile,bashrc,zshenv,zshrc,fehbg,xinitrc,Xresources} .. \
        && echo "exec bspwm" >> ~/.xinitrc \
        && cd ~ && rm -rf wm_config \
        && printf '%s\n' " ${y}Bspwm configured, rebooting...${nc}" \
        && sleep 2s && reboot
    else
        printf '%s\n' " ${r}Bspwm is not installed.${nc}"
        sleep 3s
    fi
    
}

clear
read -r -p "${g}"' Window manager config to install: [I]3wm, [B]spwm: '"${nc}" wm
case "$wm" in
    i|I) _i3Config ;;
    b|B) _bspwmConfig ::
esac
