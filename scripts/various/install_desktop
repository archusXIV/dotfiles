#!/bin/bash

# Colors
nc=$'\e[0;m';
g=$'\e[1;32m';
r=$'\e[0;31m';
y=$'\e[93m';

_lightdm() {
    pacman -Sy --needed --noconfirm lightdm lightdm-gtk-greeter
    systemctl enable lightdm.service
}

_xorg() {
    pacman -Sy --needed --noconfirm xorg-server xorg-xinit xorg-xrandr xorg-xfontsel \
    xorg-xlsfonts xorg-xkill xorg-xinput xorg-xwininfo
}

_i3wm() {
    _xorg && pacman -Sy --needed --noconfirm i3-wm i3lock i3status i3blocks polybar \
    dmenu rofi sxhkd
}

_bspwm() {
    _xorg && pacman -Sy --needed --noconfirm bspwm sxhkd xdo polybar \
    dmenu rofi    
}

_cinnamon() {
    _xorg && pacman -Sy --needed --noconfirm \
    cinnamon cinnamon-translations nemo-fileroller nemo-image-converter \
    nemo-preview xed xreader gnome-terminal metacity gnome-shell \
    && _lightdm
}

_gnome() {
    _xorg && pacman -Sy --needed --noconfirm \
    gnome gnome-extra && _lightdm
}

_kde() {
    _xorg && pacman -Sy --needed --noconfirm \
    plasma kdialog packagekit-qt5 kcalc icoutils \
    libappimage konsole dolphin kdegraphics-thumbnailers svgpart \
    ffmpegthumbs kdenetwork-filesharing gwenview kimageformats \
    ark kate okular kcron kdf filelight print-manager kdeconnect sshfs \
    && _lightdm
}

_mate() {
    _xorg && pacman -Sy --needed --noconfirm \
    mate mate-extra && _lightdm
}

_xfce() {
    _xorg && pacman -Sy --needed --noconfirm \
    xfce4 xfce4-goodies && _lightdm
}

_finish() {
    exit && umount -R /mnt && reboot
}

_DesktopChoice() {
    arch-chroot /mnt "
    printf '%s\n'
    read -r -p ${g}' Pick a new username: '${nc} name
    useradd -m -G audio,video,input,wheel,sys,log,rfkill,lp,adm -s /bin/bash $name
    passwd $name
    EDITOR=vim visudo
    printf '%s\n'
    printf '%s\n' ' ${g}Please enter your choice here, eg: 1 or 3 etc...${nc}'
    echo -e 'i3wm\nbspwm\nCinnamon\nGnome\nKDE Plasma\nMate\nXfce' | cat -n
    read -r choice
    case $choice in
        1) _i3wm && _finish ;;
        2) _bspwm && _finish ;;
        3) _cinnamon && _finish ;;
        4) _gnome && _finish ;;
        5) _kde && _finish ;;
        6) _mate && _finish ;;
        7) _xfce && _finish ;;
    esac
    "
}

_Description() {
    clear
    setfont sun12x22
    cat << EOF

                #                                                       
               # #      #####   ####  #    # #      # #    # #    # #    # 
              #   #     #    # #    # #    # #      # ##   # #    #  #  #  
             #     #    #    # #      ###### #      # # #  # #    #   ##   
            #########   #####  #      #    # #      # #  # # #    #   ##   
           #         #  #   #  #    # #    # #      # #   ## #    #  #  #  
          #           # #    #  ####  #    # ###### # #    #  ####  #    #
    
                     Base installation for lazy dudes made easy!
    
    # French (ne jamais lancer un script sans le lire auparavant)
    ${g}Ce script va installer le bureau de votre choix parmi la liste suivante:${nc}
    
    PreconfigurÃ©s:     ${y}i3wm, Bspwm${nc}
    Brut de chez brut: ${y}Cinnamon, Gnome, KDE Plasma, Mate & Xfce${nc}
    
    # English (never run a script without reading it first)
    ${g}This script will install the desktop of your choice among the following list:${nc}
    
    Preconfigured: ${y}i3wm, Bspwm${nc}
    Barebone:      ${y}Cinnamon, Gnome, KDE Plasma, Mate & Xfce${nc}
    
EOF
    printf '%s\n'
    read -r -p "${g}"'    Press enter to launch desktop installation, ^C to quit: '"${nc}" inst
    case "$inst" in *) _DesktopChoice ;; esac
}

_Description
